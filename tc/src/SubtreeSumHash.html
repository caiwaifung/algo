<html><body bgcolor="#ccffcc" text="#000000"><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td>You are given a tree T with n nodes.
The nodes are numbered 0 through n-1.
Each node of the tree has a positive integer weight.
You are given the weights in the vector &lt;int&gt; <b>weight</b> with n elements.
You are also given a vector &lt;int&gt; <b>p</b> with n-1 elements that describes the edges of the tree:
for each valid i, there is an undirected edge between nodes (i+1) and <b>p</b>[i].
The constraints ensure that this will produce a valid tree.
<br></br>
<br></br>
A subtree of T is any subgraph of T that is a tree.
The weight of a subtree is the sum of the weights of its vertices.
Let S be the multiset that contains the weights of all nonempty subtrees of T.
(In other words, for each subtree of T we calculate its total weight and add the result to S. Note that S may contain some duplicates.)
<br></br>
<br></br>
You are also given an int <b>x</b>.
This value is used to define the hash of the multiset S:
Hash(S) is defined as the sum of <b>x</b>^s over all elements s of S.
For example, if S = {2, 3, 3} then Hash(S) = <b>x</b>^2 + <b>x</b>^3 + <b>x</b>^3.
<br></br>
<br></br>
Please calculate and return the value Hash(S) modulo 1,000,000,007.</td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>SubtreeSumHash</td></tr><tr><td>Method:</td><td>count</td></tr><tr><td>Parameters:</td><td>vector &lt;int&gt;, vector &lt;int&gt;, int</td></tr><tr><td>Returns:</td><td>int</td></tr><tr><td>Method signature:</td><td>int count(vector &lt;int&gt; weight, vector &lt;int&gt; p, int x)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td colspan="2"><h3>Limits</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Time limit (s):</td><td>2.000</td></tr><tr><td>Memory limit (MB):</td><td>256</td></tr><tr><td>Stack limit (MB):</td><td>256</td></tr></table></td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>weight</b> will contain between 1 and 50 elements, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td>Each element in <b>weight</b> will be between 1 and 1,000,000,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>p</b> will contain exactly |<b>weight</b>|-1 elements.</td></tr><tr><td align="center" valign="top">-</td><td>For each i, 0 &lt= <b>p</b>[i] &lt= i.</td></tr><tr><td align="center" valign="top">-</td><td><b>x</b> will be between 1 and 1,000,000,000, inclusive.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{1,2,3}</pre></td></tr><tr><td><pre>{0,1}</pre></td></tr><tr><td><pre>10</pre></td></tr></table></td></tr><tr><td><pre>Returns: 1102110</pre></td></tr><tr><td><table><tr><td colspan="2">The tree contains the edges 1-0 and 2-1, so it looks like this: 0 - 1 - 2.
<br></br>
This tree has 6 subtrees: {0}, {1}, {2}, {0,1}, {1,2}, and {0,1,2}. Their weights are 1, 2, 3, 3, 5, and 6, respectively.
Hence, S = {1, 2, 3, 3, 5, 6} and Hash(S) = <b>x</b>^1 + <b>x</b>^2 + 2*<b>x</b>^3 + <b>x</b>^5 + <b>x</b>^6 = 10 + 100 + 2*1000 + 100000 + 1000000 = 1102110.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{123456789,987654321,111111111,999999999}</pre></td></tr><tr><td><pre>{0,0,0}</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 11</pre></td></tr><tr><td><table><tr><td colspan="2">There are 11 subtrees.
Their weights do not matter: as <b>x</b> = 1, Hash(S) is simply the number of subtrees.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{10}</pre></td></tr><tr><td><pre>{}</pre></td></tr><tr><td><pre>10</pre></td></tr></table></td></tr><tr><td><pre>Returns: 999999937</pre></td></tr><tr><td><table><tr><td colspan="2">The answer is 10^10 % (10^9+7).</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">3)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>{3,7,6,8,9,4,2,1,5,6,7,8,9,6,1,2,3,5}</pre></td></tr><tr><td><pre>{0,0,0,3,1,1,2,0,0,3,7,8,9,0,0,4,1}</pre></td></tr><tr><td><pre>987654321</pre></td></tr></table></td></tr><tr><td><pre>Returns: 46327623</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>
