<html><body bgcolor="#ccffcc" text="#000000"><table><tr><td colspan="2"><h3>Problem Statement</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td>Given a directed graph G, we will use p(G) to denote the number of ordered pairs of distinct vertices (x,y) such that G contains a directed path from x to y.<br></br><br></br>

For example, let G1 be a graph on vertices {0,1,2} that contains the edges 0-&gt;1 and 1-&gt;2.
For this graph we have p(G1)=3: there is a path from 0 to 1, a path from 1 to 2, and a path from 0 to 2.
Similarly, let G2 contain the edges 0-&gt;1 and 2-&gt;1.
Then p(G2)=2: the only two valid paths are from 0 to 1 and from 2 to 1.<br></br><br></br>

You are given an undirected tree T with <b>N</b> vertices.
The vertices are numbered 0 through <b>N</b>-1.
The exact format in which T is given is specified below.<br></br><br></br>

We can change T into a directed graph U by replacing each undirected edge of T by one of the two possible directed edges.
As there are exactly <b>N</b>-1 edges in T, there are exactly 2^(<b>N</b>-1) possible graphs U we can produce.<br></br><br></br>

For each possible U compute the value p(U).
Let X be the sum of those 2^(<b>N</b>-1) values.
Compute and return the value (X modulo 1,000,000,007).<br></br><br></br>

You are given the ints <b>N</b>, <b>A0</b>, <b>B</b>, <b>C</b>, and <b>MOD</b>.
Use the pseudocode given below to generate the tree T.
Watch out for integer overflow.<br></br><br></br>
<pre>
A[0] = A0
for i = 1 .. N-2:
	A[i] = (B * A[i-1] + C) % MOD

for i = 1 .. N-1:
	j = A[i-1] % i
	add an edge between vertices i and j 
</pre></td></tr><tr><td colspan="2"><h3>Definition</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Class:</td><td>TreeWalker</td></tr><tr><td>Method:</td><td>calc</td></tr><tr><td>Parameters:</td><td>int, int, int, int, int</td></tr><tr><td>Returns:</td><td>int</td></tr><tr><td>Method signature:</td><td>int calc(int N, int A0, int B, int C, int MOD)</td></tr><tr><td colspan="2">(be sure your method is public)</td></tr></table></td></tr><tr><td colspan="2"><h3>Limits</h3></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td>Time limit (s):</td><td>2.000</td></tr><tr><td>Memory limit (MB):</td><td>256</td></tr><tr><td>Stack limit (MB):</td><td>256</td></tr></table></td></tr><tr><td colspan="2"><h3>Constraints</h3></td></tr><tr><td align="center" valign="top">-</td><td><b>N</b> will be between 2 and 100,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>A0</b>, <b>B</b> and <b>C</b> will be between 0 and 1,000,000,000, inclusive.</td></tr><tr><td align="center" valign="top">-</td><td><b>MOD</b> will be between 1 and 1,000,000,000, inclusive.</td></tr><tr><td colspan="2"><h3>Examples</h3></td></tr><tr><td align="center" nowrap="true">0)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>4</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1000</pre></td></tr></table></td></tr><tr><td><pre>Returns: 34</pre></td></tr><tr><td><table><tr><td colspan="2">The graph T generated by our pseudocode is the path 0 - 1 - 2 - 3.
There are 2^3 = 8 possible ways to assign directions to these edges:
<ul>
<li>In two cases (0 -&gt; 1 -&gt; 2 -&gt; 3, 0 &lt;- 1 &lt;- 2 &lt;- 3) we have p(U) = 6.</li>
<li>In four cases (0 -&gt; 1 -&gt; 2 &lt;- 3, 0 -&gt; 1 &lt;- 2 &lt;- 3, 0 &lt;- 1 -&gt; 2 -&gt; 3, 0 &lt;- 1 &lt;- 2 -&gt; 3) we have p(U) = 4.</li>
<li>In two cases (0 -&gt; 1 &lt;- 2 -&gt; 3, 0 &lt;- 1 -&gt; 2 &lt;- 3) we have p(U) = 3.</li>
</ul>
The sum of p(U) over all possible U is X = 6+6+4+4+4+4+3+3 = 34.</td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">1)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>10</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>0</pre></td></tr><tr><td><pre>1</pre></td></tr></table></td></tr><tr><td><pre>Returns: 13824</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">2)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>16</pre></td></tr><tr><td><pre>15</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>1</pre></td></tr><tr><td><pre>16</pre></td></tr></table></td></tr><tr><td><pre>Returns: 917506</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">3)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>1000</pre></td></tr><tr><td><pre>385498676</pre></td></tr><tr><td><pre>349131547</pre></td></tr><tr><td><pre>115776323</pre></td></tr><tr><td><pre>614879544</pre></td></tr></table></td></tr><tr><td><pre>Returns: 245566366</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr><tr><td align="center" nowrap="true">4)</td><td></td></tr><tr><td>&#160;&#160;&#160;&#160;</td><td><table><tr><td><table><tr><td><pre>100000</pre></td></tr><tr><td><pre>111222333</pre></td></tr><tr><td><pre>444555666</pre></td></tr><tr><td><pre>777888999</pre></td></tr><tr><td><pre>123456789</pre></td></tr></table></td></tr><tr><td><pre>Returns: 119729770</pre></td></tr><tr><td><table><tr><td colspan="2"></td></tr></table></td></tr></table></td></tr></table><p>This problem statement is the exclusive and proprietary property of TopCoder, Inc.  Any unauthorized use or reproduction of this information without the prior written consent of TopCoder, Inc. is strictly prohibited.  (c)2003, TopCoder, Inc.  All rights reserved.  </p></body></html>
